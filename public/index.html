<html>

<head>
  <title>Listen Up - Super Simple Webhook Testing</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="description" content="Test your webhooks by using a simple generated endpoint and see your HTTP request come through in realtime.">
  <link href="https://fonts.googleapis.com/css?family=Playfair+Display:400,900" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.7.1/css/bulma.css" rel="stylesheet">
  <script defer src="https://use.fontawesome.com/releases/v5.1.0/js/all.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/date-fns/1.29.0/date_fns.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    .has-text-centered {
      text-align: center;
    }

    .title-text {
      font-weight: bold;
      font-family: 'Playfair Display', serif;
    }

    h1,
    h2,
    h3,
    h4 {
      font-family: 'Playfair Display', serif;
    }

    h1 {
      font-weight: 900;
    }

    h2 {
      font-size: 2em;
      font-weight: 100;
    }

    .spinner {
      display: inline-block;
      width: 18px;
      height: 18px;
    }

    .spinner:after {
      content: " ";
      display: block;
      width: 18px;
      height: 18px;
      margin: 2px auto;
      border-radius: 50%;
      border: 5px solid #333;
      border-color: #333 transparent #333 transparent;
      animation: spinner 1.5s linear infinite;
    }

    @keyframes spinner {
      0% {
        transform: rotate(0deg);
      }
      100% {
        transform: rotate(360deg);
      }
    }

    #app {
      margin: 20px auto;
    }

    .hidden {
      display: none;
    }

    .expanded {
      display: block;
    }

    .columns {
      width: 100%
    }

    [v-cloak] {
      display: none;
    }

    .count {
      margin-top: 2px;
      margin-right: 4px;
    }

    .fade-enter-active,
    .fade-leave-active {
      transition: opacity .2s;
    }

    .fade-enter,
    .fade-leave-to
    /* .fade-leave-active below version 2.1.8 */

      {
      opacity: 0;
    }
  </style>
</head>

<body>
  <section class="hero is-warning is-bold is-fullheight">
    <div class="hero-body">
      <div id="app" class="container" v-cloak>
        <h1 class="has-text-centered" style="font-size: 5em;">
          <i class="fas fa-headphones"></i>
        </h1>
        <h1 class="title has-text-centered is-size-1">Listen Up</h1>
        <h2 class="subtitle is-size-5 has-text-centered">Super Simple Webhook Testing</h2>
        <!--CREATE HOOK BUTTON-->
        <div class="has-text-centered" v-if="!showListener">
          <button class="button is-dark" v-bind:class="{ 'is-loading': isLoading }" v-on:click="createHook">Create New Hook Endpoint</button>
        </div>

        <!--TOP MESSAGE PANEL-->
        <article class="message is-dark" v-if="showListener">
          <div class="message-header">
            <span v-if="!staleHook">
              <p>
                <i class="far fa-check-circle"></i> Endpoint Ready</p>
            </span>
            <span v-if="staleHook">
              <p>
                <i class="fas fa-ban"></i>Endpoint Expired</p>
            </span>
          </div>
          <div class="message-body">
            <div class="field">
              <div class="field-body">
                <div class="field has-addons">
                  <div class="control is-expanded">
                    <input class="input" type="text" v-model="currentEndpoint" id="endpoint" readonly>
                  </div>
                  <div class="control">
                    <a class="button is-light-grey" v-on:click="copyText">
                      <span class="icon is-small">
                        <i class="fas fa-copy"></i>
                      </span>
                      <span>Copy</span>
                    </a>
                  </div>
                </div>
              </div>
            </div>

            <button class="button is-gray" v-bind:class="{ 'is-loading': isLoading }" v-on:click="createHook">
              Create New Hook Endpoint
            </button>
          </div>
        </article>

        <!--ERROR MESSAGE PANEL-->
        <article class="message is-danger" v-if="staleHook">
          <div class="message-body">
            <p>Looks like you need a new endpoint or to renew your existing one.</p>
            <button class="button is-gray is-small is-centered" v-on:click="renewHook">Renew Endpoint</button>
        </article>

        <!--LISTENER LIST PANEL-->
        <div id="listen" v-if="showRequests">
          <nav class="panel">
            <p class="panel-heading is-clearfix">
              <span class="spinner"></span>
              Listening for Requests...
              <button class="button is-small is-pulled-right" v-on:click="clearList">Clear List</button>
              <span class="count tag is-rounded is-dark is-small is-pulled-right">Received {{count}}</span>
            </p>
            <post-block v-for="post in posts" v-bind:post="post" :key="post._id" inline-template>
              <transition name="fade">
                <div class="panel-block has-background-white">
                  <div class="columns">
                    <div class="column is-2">
                      <div class="field">
                        <div class="tag is-light">{{ post.time }}</div>
                      </div>
                      <div class="field">
                        <a class="button is-small" @click="toggleHeaders">
                          <span class="icon is-small">
                            <i class="fas fa-eye"></i>
                          </span>
                          <span>
                            {{ showHide }} Headers
                          </span>
                        </a>
                      </div>
                    </div>
                    <div class="column is-10">
                      <transition name="fade">
                        <div v-show="showHeaders">
                          <div class="field">
                            <pre>{{ post.headers }}</pre>
                          </div>
                        </div>
                      </transition>
                      <div class="field">
                        <pre>{{ post.payload }}</pre>
                      </div>
                    </div>
                  </div>
                </div>
              </transition>
            </post-block>
            <div class="panel-block has-background-white" v-if="!posts.length">
              No Data
            </div>
            <div class="panel-block has-background-light">
              <button class="button is-small" v-on:click="clearList">Clear List</button>
            </div>
          </nav>
          <small class="tag">
            <em>Endpoints expire after 8 hours. Data is not persisted.</em>
          </small>
        </div>
        </div>


        <script src="https://cdn.jsdelivr.net/npm/vue@2.5.16/dist/vue.min.js"></script>
        <script src="//unpkg.com/@feathersjs/client@^3.0.0/dist/feathers.min.js"></script>
        <script src="//cdnjs.cloudflare.com/ajax/libs/socket.io/2.1.1/socket.io.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/URI.js/1.19.1/URI.min.js"></script>
        <script src="js/app.js"></script>
      </div>
      <div class="hero-foot is-warning is-bold">
        <footer class="footer">
          <div class="content has-text-centered">
            <div>
              Listen Up &copy; 2018 Josh Weaver
            </div>
            <a href="https://github.com/3Cordguy/listen-up">
              <span class="icon is-large">
                <i class="fab fa-2x fa-github-square"></i>
              </span>
            </a>
            <a href="https://bulma.io">
              <img src="https://bulma.io/images/made-with-bulma.png" alt="Made with Bulma" width="128" height="24">
            </a>
          </div>
        </footer>
      </div>
  </section>
</body>

</html>